package converter

import (
	"encoding/hex"
	"testing"
)

func TestConvert2OtelSpan(t *testing.T) {
	convertor := NewConverter("json")
	data := "5b7b2274726163654964223a223632653839343765346633346430313230373265313561306334343561653636222c226964223a2230373265313561306334343561653636222c226b696e64223a22534552564552222c226e616d65223a22706f7374222c2274696d657374616d70223a313635393430393533343130393030342c226475726174696f6e223a34393738312c226c6f63616c456e64706f696e74223a7b22736572766963654e616d65223a227468696e6767617465776179222c2269707634223a223137322e31362e382e313633227d2c2272656d6f7465456e64706f696e74223a7b2269707634223a2234392e37372e3134362e313739227d2c2274616773223a7b22687474702e6d6574686f64223a22504f5354222c22687474702e70617468223a222f73747564696f2d6e6f746963652f6e6f746963652d6d6573736167652f76312f617574682f71756572792d76616c6964227d7d2c7b2274726163654964223a223632653839343765346633346430313230373265313561306334343561653636222c22706172656e744964223a2230373265313561306334343561653636222c226964223a2265393933386132623562386432663035222c226b696e64223a22434c49454e54222c226e616d65223a22706f7374222c2274696d657374616d70223a313635393430393533343135353230362c226475726174696f6e223a333539372c226c6f63616c456e64706f696e74223a7b22736572766963654e616d65223a227468696e6767617465776179222c2269707634223a223137322e31362e382e313633227d2c2272656d6f7465456e64706f696e74223a7b2269707634223a223137322e31362e382e313938222c22706f7274223a33303030337d2c2274616773223a7b22687474702e6d6574686f64223a22504f5354222c22687474702e70617468223a222f6e6f746963652d6d6573736167652f76312f617574682f71756572792d76616c6964227d7d2c7b2274726163654964223a223632653839343765646234373130353965323963346535656134336332663263222c226964223a2265323963346535656134336332663263222c226b696e64223a22534552564552222c226e616d65223a22706f7374222c2274696d657374616d70223a313635393430393533343131343030322c226475726174696f6e223a35313138312c226c6f63616c456e64706f696e74223a7b22736572766963654e616d65223a227468696e6767617465776179222c2269707634223a223137322e31362e382e313633227d2c2272656d6f7465456e64706f696e74223a7b2269707634223a2234392e37372e3134362e313739227d2c2274616773223a7b22687474702e6d6574686f64223a22504f5354222c22687474702e70617468223a222f73747564696f2d6e6f746963652f61637469766974792d6d6573736167652f76312f617574682f71756572792d76616c6964227d7d2c7b2274726163654964223a223632653839343765646234373130353965323963346535656134336332663263222c22706172656e744964223a2265323963346535656134336332663263222c226964223a2264636230623032633834343362653961222c226b696e64223a22434c49454e54222c226e616d65223a22706f7374222c2274696d657374616d70223a313635393430393533343136313632372c226475726174696f6e223a333538302c226c6f63616c456e64706f696e74223a7b22736572766963654e616d65223a227468696e6767617465776179222c2269707634223a223137322e31362e382e313633227d2c2272656d6f7465456e64706f696e74223a7b2269707634223a223137322e31362e382e313938222c22706f7274223a33303030337d2c2274616773223a7b22687474702e6d6574686f64223a22504f5354222c22687474702e70617468223a222f61637469766974792d6d6573736167652f76312f617574682f71756572792d76616c6964227d7d5d"
	dataArray, _ := hex.DecodeString(data)
	zSpans, _ := convertor.ParseSpans(dataArray, false)
	if d1, err := Convert2OtelSpan(zSpans); err != nil {
		t.Errorf("Convert Failed. %v", err)
	} else {
		if len(d1) != 1 {
			t.Errorf("Trace Size: Expected 1, Acutal: %d", len(d1))
		}
	}
}
